app: retroshare

build:
  packages:
    - desktop-file-utils
    - doxygen
    - gcc-c++
    - glib2-devel
    - libqt5-qtbase-devel
    - libqt5-qtmultimedia-devel
    - libqt5-qttools-devel
    - libqt5-qtsvg-devel
    - libqt5-qtx11extras-devel
    - libxapian-devel
    - libXScrnSaver-devel
    - openssl-devel
    - update-desktop-files
    - linuxdeployqt
    - libupnp-devel
    - sqlcipher-devel

script:
  - lsb_release -a
  - cd $BUILD_SOURCE_DIR
  - tar -xf retroshare_XXXXXX.tar.gz
  - cd retroshare-YYYYYY
  - qmake-qt5 --version
  - ls $(which gcc)*
  - ls $(which g++)*
  - gcc --version
  - sed -i 's/retroshare.xpm/retroshare/' data/retroshare.desktop
  - sed -i 's|/usr/bin/retroshare|retroshare|' data/retroshare.desktop
  - qmake-qt5 PREFIX=/usr RS_MAJOR_VERSION=0 RS_MINOR_VERSION=6 RS_MINI_VERSION=7 RS_EXTRA_VERSION="-OBS-AppImage" CONFIG-=debug CONFIG+=release CONFIG+=no_retroshare_plugins CONFIG+=no_tests CONFIG+=rs_jsonapi CONFIG+=rs_webui CONFIG+=no_retroshare_service CONFIG+=c++14 CONFIG+=appimage 
  - make -j$(nproc) || make -j$(nproc) || make
  - make INSTALL_ROOT=$BUILD_APPDIR install
  - unset QTDIR; unset QT_PLUGIN_PATH ; unset LD_LIBRARY_PATH
  - linuxdeployqt $BUILD_APPDIR/usr/share/applications/*.desktop -executable=$BUILD_APPDIR/usr/bin/retroshare -bundle-non-qt-libs -verbose=3 -no-strip -extra-plugins=iconengines/libqsvgicon.so
 
